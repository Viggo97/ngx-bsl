<input
    type="text"
    role="combobox"
    #comboboxInput
    cdkOverlayOrigin
    [value]="value | listBoxOptionValueConverter : bindLabel()"
    [attr.aria-expanded]="open()"
    [attr.aria-controls]="'list-box-' + id()"
    [attr.aria-label]="ariaLabel()"
    [attr.aria-labelledby]="ariaLabelledBy()"
    [attr.aria-activedescendant]="ariaActiveDescendant()"
    (input)="onInputChange($any($event))"
    (click)="onClick()"
    (keydown.enter)="onKeydown($any($event))"
    (keydown.arrowUp)="onKeydown($any($event))"
    (keydown.arrowDown)="onKeydown($any($event))"
    (keydown.escape)="hideListBox()"
>
<ng-template
    cdkConnectedOverlay
    [cdkConnectedOverlayOrigin]="comboboxInput"
    [cdkConnectedOverlayOpen]="open()"
    [cdkConnectedOverlayWidth]="comboboxInput.offsetWidth"
    (overlayOutsideClick)="hideListBox()">
    <ngx-bsl-list-box
        [initialValue]="value"
        [initialFocusedOptionIndex]="initialFocusedOptionIndex()"
        [comparisonField]="comparisonField()"
        [id]="'list-box-' + id()"
        [ariaLabel]="ariaLabel()"
        [ariaLabelledby]="ariaLabelledBy()"
        [exposeAriaActiveDescendant]="true"
        (selectOption)="onSelectOption($event)">
        @if (!optionsGroup()) {
            @for (option of options(); track option; let index = $index) {
                <ngx-bsl-list-box-option
                    [id]="'list-box-option-' + id()"
                    [value]="option">
                    <ng-container>{{ option | listBoxOptionValueConverter : bindLabel() }}</ng-container>
                </ngx-bsl-list-box-option>
            }
        }
        @else {
            @for (group of optionsGroup(); track group) {
                <ngx-bsl-list-box-group [title]="group.group"></ngx-bsl-list-box-group>
                @for (option of group.data; track option; let index = $index) {
                    <ngx-bsl-list-box-option
                        [id]="'list-box-option-' + id()"
                        [value]="option">
                        <ng-container>{{ option | listBoxOptionValueConverter : bindLabel() }}</ng-container>
                    </ngx-bsl-list-box-option>
                }
            }
        }
        @if (!options().length && noOptionsMessage()) {
            <span class="list-box-no-options-message">{{ noOptionsMessage() }}</span>
        }
    </ngx-bsl-list-box>
</ng-template>
